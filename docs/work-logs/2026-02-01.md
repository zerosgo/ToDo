# 작업 기록: 2026-02-01

## 📋 작업 요약

### 1. 드래그 앤 드롭 (DnD) 문제 해결

#### 문제 1: 캘린더 화면 유지 안됨
- **원인**: 사이드바에서 메모를 드래그할 때 `onClick` 이벤트가 발생하여 화면이 Keep 뷰로 전환됨
- **해결**: `Sidebar.tsx`에서 `mousedown/mouseup` 기반 드래그 감지 로직 추가
  - `dragStartPos` ref로 마우스 위치 추적
  - 5px 미만 이동 시에만 클릭으로 인식

#### 문제 2: URL 병합 안됨
- **원인**: `addNote(content, 'yellow')` 호출 시 인수 순서 오류 - `title`에 전체 내용이 들어가고 `content`는 비어있었음
- **해결**: 
  - `page.tsx`: `addNote(noteTitle, noteContent, 'yellow')` 로 올바르게 수정
  - `calendar-view.tsx`: `note.title` + `note.content` 둘 다 확인하여 URL 추출

#### 문제 3: 일정 Import 후 화면 전환
- **원인**: `handleScheduleImport` 완료 시 `setViewMode('keep')` 호출
- **해결**: `page.tsx`에서 `window.confirm` 대신 `window.alert` 사용, 화면 전환 제거

---

### 2. 수동 일정 보호 기능 추가

#### 요구사항
- 사용자가 수동으로 추가한 일정이 "팀 일정 가져오기" 시 삭제되지 않도록 보호

#### 구현
1. **Task 타입에 `source` 필드 추가** (`types.ts`)
   ```typescript
   source?: 'team' | 'manual';
   ```

2. **팀 일정 가져오기 수정** (`page.tsx`)
   - 새 일정에 `source: 'team'` 설정
   - 삭제 시 `source === 'manual'`인 일정은 보호

3. **UI 추가 시 `source: 'manual'` 설정**
   - `task-list.tsx`: 빠른 추가
   - `task-detail-dialog.tsx`: 상세 화면 추가
   - `team-schedule-add-modal.tsx`: 수동 팀 일정 추가

#### 중복 이슈 및 해결
- 초기에 `source !== 'team'` 조건 사용 → 기존 일정(source: undefined)도 보호되어 중복 발생
- `source === 'manual'`로 변경하여 명시적 수동 일정만 보호

---

## 📁 수정된 파일

| 파일 | 변경 내용 |
|------|----------|
| `src/lib/types.ts` | Task에 `source?: 'team' \| 'manual'` 필드 추가 |
| `src/app/page.tsx` | 일정 Import 로직 수정, 백업 메모 생성 수정, 화면 전환 제거 |
| `src/components/sidebar.tsx` | 드래그/클릭 분리 로직 (`useRef`, `mousedown/mouseup`) |
| `src/components/calendar-view.tsx` | URL 추출 로직 개선 (title+content 확인) |
| `src/components/task-list.tsx` | `source: 'manual'` 추가 |
| `src/components/task-detail-dialog.tsx` | `source: 'manual'` 추가 |
| `src/components/team-schedule-add-modal.tsx` | `source: 'manual'` 추가 |

---

## 🧪 테스트 방법

1. **DnD 테스트**: 사이드바 고정 메모를 캘린더 일정으로 드래그 → URL/메모 병합 확인
2. **수동 일정 보호**: 수동으로 팀 일정 추가 후 "팀 일정 가져오기" 실행 → 수동 일정 유지 확인

---

## ⚠️ 주의사항

- 기존 일정(`source: undefined`)은 다음 "팀 일정 가져오기" 시 삭제됨
- 수동으로 추가한 일정(`source: 'manual'`)만 보호됨
